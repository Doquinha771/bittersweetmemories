<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PS2 Music Player Experience</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --ps2-bg: #5f5f6e;
            --ps2-yellow: #ffff00;
            --ps2-blue: #0096ff;
            --ps2-white: #e0e0e0;
        }

        @keyframes spin-2d {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }
        @keyframes scanlines {
            0% { background-position: 0 0; }
            100% { background-position: 0 50px; }
        }
        @keyframes cd-glare {
            0% { transform: translateX(-150%) skewX(-30deg); }
            100% { transform: translateX(150%) skewX(-30deg); }
        }
        @keyframes jitter {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(0.5px, -0.5px); }
            50% { transform: translate(-0.5px, 0.5px); }
            75% { transform: translate(0.5px, 0.5px); }
        }

        body {
            background-color: #111;
            font-family: 'VT323', monospace;
            color: var(--ps2-white);
            overflow: hidden;
        }

        .crt-filter {
            position: relative;
            width: 100vw;
            height: 100vh;
            filter: blur(0.5px) contrast(1.1);
            animation: jitter 0.1s infinite;
        }
        .crt-filter::before { /* Scanlines overlay */
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 3px, 3px 100%;
            z-index: 2;
            pointer-events: none;
            animation: scanlines 0.2s infinite linear;
        }
        .crt-filter::after { /* Vignette overlay */
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.5);
            z-index: 2;
            pointer-events: none;
        }

        .screen {
            background-color: var(--ps2-bg);
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s, visibility 0.5s, background-color 0.5s;
            opacity: 0;
            visibility: hidden;
            text-shadow: 1px 1px 1px rgba(255,0,0,0.3), -1px -1px 1px rgba(0,0,255,0.3);
        }
        .screen.active {
            opacity: 1;
            visibility: visible;
            animation: fadeIn 0.5s ease-out;
        }
        .screen.hiding {
            animation: fadeOut 0.5s ease-in;
        }

        /* --- Selection Screen --- */
        #selection-screen .cd-selection-item {
            perspective: 800px;
            cursor: pointer;
        }
        #selection-screen .cd-art {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            border: 5px solid #333;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            transition: transform 0.4s ease;
        }
        #selection-screen .cd-selection-item:hover .cd-art {
            transform: rotateY(20deg) scale(1.1);
        }

        /* --- Player Screen --- */
        .player-container {
            width: 100%;
            max-width: 800px;
            margin: auto;
        }

        /* 2D CD Style */
        .cd-2d-container {
            width: 200px;
            height: 200px;
        }
        .cd-2d {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            background-size: cover;
            background-position: center;
            box-shadow: 0 0 25px rgba(0,0,0,0.5);
            animation: spin-2d 15s linear infinite;
            overflow: hidden; /* For glare effect */
        }
        .cd-2d.playing {
            animation-duration: 5s;
        }
        .cd-2d::after { /* Glare effect */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0) 100%);
            animation: cd-glare 5s linear infinite;
        }
        .cd-hole {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--ps2-bg);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.7);
        }
        
        /* Track Info & Controls */
        .track-info { font-size: 1.5rem; line-height: 1.75rem; }
        .track-number { color: var(--ps2-yellow); font-weight: bold; font-size: 2.25rem; }
        .track-name { font-size: 1.875rem; min-height: 56px; }
        .time-display { font-size: 1.5rem; }

        /* Progress Bar */
        .progress-bar-container {
            width: 100%;
            height: 20px;
            background-color: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 4px;
            overflow: hidden;
        }
        .progress-bar-fill {
            width: 0%;
            height: 100%;
            background-color: var(--ps2-blue);
            border-radius: 6px;
            transition: width 0.5s linear;
        }

        .controls svg { width: 32px; height: 32px; fill: var(--ps2-white); }
        .controls .play-icon { fill: var(--ps2-blue); }
        .controls button { background: none; border: none; padding: 8px; opacity: 0.8; transition: opacity 0.2s; cursor: pointer; }
        .controls button:hover { opacity: 1; }

        /* Footer Prompts */
        .footer-prompts { font-size: 1.5rem; }
        .prompt-icon { display: inline-block; width: 24px; height: 24px; border: 2px solid var(--ps2-white); border-radius: 50%; text-align: center; line-height: 1.1; font-weight: bold; margin-right: 8px; }
        .prompt-o { color: #ff4444; border-color: #ff4444; }

    </style>
</head>
<body>

    <div class="crt-filter">
        <!-- Screen 1: CD Selection -->
        <div id="selection-screen" class="screen active">
            <div class="text-center">
                <h1 class="text-5xl text-white mb-12" style="text-shadow: 2px 2px 0 var(--ps2-blue);">Select Disc</h1>
                <div id="cd-selection-container" class="flex flex-wrap justify-center gap-8">
                    <!-- CD items will be injected here -->
                </div>
            </div>
        </div>

        <!-- Screen 2: Music Player -->
        <div id="player-screen" class="screen">
            <div class="player-container p-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <!-- Left Side: 2D CD -->
                    <div class="cd-2d-container mx-auto">
                        <div id="cd-2d" class="cd-2d">
                            <div class="cd-hole"></div>
                        </div>
                    </div>

                    <!-- Right Side: Info & Controls -->
                    <div class="track-info text-center md:text-left space-y-2">
                        <h2 id="track-number" class="track-number">Track 01</h2>
                        <p id="track-name" class="track-name">Loading...</p>
                        <div id="progress-bar-container" class="progress-bar-container">
                            <div id="progress-bar-fill" class="progress-bar-fill"></div>
                        </div>
                        <p id="time-display" class="time-display">00:00 / 00:00</p>
                        
                        <div class="controls flex items-center justify-center md:justify-start space-x-2">
                            <button id="prev-btn"><svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
                            <button id="play-btn"><svg class="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button>
                            <button id="pause-btn" class="hidden"><svg class="play-icon" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg></button>
                            <button id="next-btn"><svg viewBox="0 0 24 24"><path d="M16 6h2v12h-2zm-3.5 6l-8.5 6V6z"/></svg></button>
                            <button id="stop-btn"><svg viewBox="0 0 24 24"><path d="M6 6h12v12H6z"/></svg></button>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div id="back-btn" class="footer-prompts flex justify-center md:justify-end space-x-8 mt-12 cursor-pointer">
                    <div><span class="prompt-o">O</span> Back</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden YouTube Player -->
    <div id="youtube-player" class="absolute -left-full"></div>
    
    <script>
        // --- DATA ---
        const albums = [
            {
                name: "Sucesso FM",
                coverUrl: "https://i1.sndcdn.com/artworks-zMJy5oUhjfM05LnK-AzuGwA-t500x500.jpg",
                bgColor: "rgba(0, 80, 150, 0.2)",
                tracks: [
                    { videoId: 'tkl_smLRtcE', title: "Sucesso FM" },
                    { videoId: 'gTsZ-vQLq74', title: "Rumo a Vitória" },
                    { videoId: 'fGhkeEmMDSU', title: "Goddamn" },
                    { videoId: 'pKyoxG2ZDh8', title: "I Walk" },
                    { videoId: '-1WfKz06Hgc', title: "Waiting to Fly" },
                    { videoId: 'llJZ4H4zQ2k', title: "Sonhar" },
                    { videoId: 'TQ2OtyCtOMc', title: "I'm in Love" },
                    { videoId: 'u3M_KURTWKY', title: "For My Family" },
                    { videoId: 'm8SzrWpCjKU', title: "Going Home" },
                    { videoId: 'rfIV2uGZ2kM', title: "The Lord and Me" },
                    { videoId: 'ozu12D-DdJk', title: "Anjos da Guarda" },
                    { videoId: 'HjA6fwTInT0', title: "We Gold" },
                ]
            },
            {
                name: "Rock Classics",
                coverUrl: "https://i.scdn.co/image/ab67616d0000b273b5c0635115c58a5257685565",
                bgColor: "rgba(150, 20, 20, 0.1)", // Example color for the other album
                tracks: [
                    { videoId: '1w7OgIMMRc4', title: "Bohemian Rhapsody" },
                    { videoId: 'v2AC41dglnM', title: "Hotel California" },
                    { videoId: 'fJ9rUzIMcZQ', title: "Stairway to Heaven" },
                ]
            }
        ];
        let currentAlbumIndex = 0;
        let currentTrackIndex = 0;
        let ytPlayer;
        let progressInterval;
        let isApiLoaded = false;
        let isPlayerReady = false;

        // --- DOM ELEMENTS ---
        const selectionScreen = document.getElementById('selection-screen');
        const playerScreen = document.getElementById('player-screen');
        const cdSelectionContainer = document.getElementById('cd-selection-container');
        const cd2d = document.getElementById('cd-2d');
        // Player Controls
        const playBtn = document.getElementById('play-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const stopBtn = document.getElementById('stop-btn');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const backBtn = document.getElementById('back-btn');
        // Display
        const trackNumberEl = document.getElementById('track-number');
        const trackNameEl = document.getElementById('track-name');
        const timeDisplayEl = document.getElementById('time-display');
        const progressBarFill = document.getElementById('progress-bar-fill');

        // --- YOUTUBE API ---
        function loadYouTubeAPI() {
            if (isApiLoaded) return;
            isApiLoaded = true;
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        }

        function onYouTubeIframeAPIReady() {
            // This function is now called when the dynamically loaded script is ready.
            // We create the player here, triggered by the first click.
            ytPlayer = new YT.Player('youtube-player', {
                height: '1', width: '1',
                playerVars: { 'controls': 0, 'fs': 0, 'iv_load_policy': 3, 'modestbranding': 1 },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }
        
        function onPlayerStateChange(event) {
            const isPlaying = event.data === YT.PlayerState.PLAYING;
            updateUIIsPlaying(isPlaying);
            
            if (isPlaying) {
                startProgressUpdater();
            } else {
                stopProgressUpdater();
            }
            
            if (event.data === YT.PlayerState.ENDED) {
                playNextTrack();
            }
        }

        // --- NAVIGATION & SETUP ---
        function renderSelectionScreen() {
            cdSelectionContainer.innerHTML = '';
            albums.forEach((album, index) => {
                const item = document.createElement('div');
                item.className = 'cd-selection-item';
                item.innerHTML = `<div class="cd-art" style="background-image: url('${album.coverUrl}')"></div>`;
                item.onclick = () => selectAlbum(index);
                cdSelectionContainer.appendChild(item);
            });
        }

        function selectAlbum(index) {
            currentAlbumIndex = index;
            currentTrackIndex = 0;
            
            const selectedAlbum = albums[index];
            playerScreen.style.backgroundColor = selectedAlbum.bgColor || 'var(--ps2-bg)';

            // The "Magic Click" - load the API and let the callbacks handle the rest.
            if (!isApiLoaded) {
                loadYouTubeAPI();
            } else if (!ytPlayer) {
                // If API is loaded but player not created yet (rare case)
                onYouTubeIframeAPIReady();
            } else {
                // If everything is ready, just load and play.
                loadTrack(currentTrackIndex, true);
            }
            
            transitionToScreen(playerScreen);
        }

        function onPlayerReady(event) {
            isPlayerReady = true;
            // This is the key. The player is ready because of the user's click.
            // Now we can load and play the track the user selected.
            loadTrack(currentTrackIndex, true);
        }
        
        function returnToSelection() {
            stopMusic();
            playerScreen.style.backgroundColor = 'var(--ps2-bg)';
            transitionToScreen(selectionScreen);
        }

        function transitionToScreen(targetScreen) {
            const currentScreen = document.querySelector('.screen.active');
            if (currentScreen) {
                currentScreen.classList.add('hiding');
                currentScreen.classList.remove('active');
            }
            setTimeout(() => {
                if(currentScreen) currentScreen.classList.remove('hiding');
                targetScreen.classList.add('active');
            }, 500);
        }

        // --- PLAYER LOGIC (DEFINITIVE FIX) ---
        function loadTrack(index, autoplay = false) {
            if (!isPlayerReady) return;
            const album = albums[currentAlbumIndex];
            if (index < 0 || index >= album.tracks.length) return;
            const track = album.tracks[index];
            currentTrackIndex = index;
            updateTrackInfo(album.coverUrl, track.title, index + 1);
            
            if (autoplay) {
                ytPlayer.loadVideoById(track.videoId);
            } else {
                ytPlayer.cueVideoById(track.videoId);
            }
        }

        function playMusic() { if (ytPlayer) ytPlayer.playVideo(); }
        function pauseMusic() { if (ytPlayer) ytPlayer.pauseVideo(); }
        function stopMusic() {
            if (ytPlayer && typeof ytPlayer.stopVideo === 'function') {
                ytPlayer.stopVideo();
            }
            updateUIIsPlaying(false);
        }
        function playNextTrack() { loadTrack((currentTrackIndex + 1) % albums[currentAlbumIndex].tracks.length, true); }
        function playPrevTrack() { loadTrack((currentTrackIndex - 1 + albums[currentAlbumIndex].tracks.length) % albums[currentAlbumIndex].tracks.length, true); }

        // --- UI UPDATES ---
        function updateTrackInfo(coverUrl, trackName, trackNumber) {
            trackNumberEl.textContent = `Track ${String(trackNumber).padStart(2, '0')}`;
            trackNameEl.textContent = trackName;
            cd2d.style.backgroundImage = `url('${coverUrl}')`;
        }
        function updateUIIsPlaying(playing) {
            cd2d.classList.toggle('playing', playing);
            playBtn.classList.toggle('hidden', playing);
            pauseBtn.classList.toggle('hidden', !playing);
        }
        function formatTime(seconds) {
            seconds = Math.floor(seconds) || 0;
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }
        function updateTimeDisplay(currentTime, duration) {
            timeDisplayEl.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
            if (duration > 0) {
                progressBarFill.style.width = `${(currentTime / duration) * 100}%`;
            } else {
                progressBarFill.style.width = '0%';
            }
        }

        // --- PROGRESS UPDATER ---
        function startProgressUpdater() {
            stopProgressUpdater();
            progressInterval = setInterval(() => {
                if (ytPlayer && typeof ytPlayer.getCurrentTime === 'function') {
                    const currentTime = ytPlayer.getCurrentTime();
                    const duration = ytPlayer.getDuration();
                    updateTimeDisplay(currentTime, duration);
                }
            }, 500);
        }
        function stopProgressUpdater() { clearInterval(progressInterval); }

        // --- INITIALIZATION ---
        window.onload = () => {
            renderSelectionScreen();
            playBtn.addEventListener('click', playMusic);
            pauseBtn.addEventListener('click', pauseMusic);
            stopBtn.addEventListener('click', stopMusic);
            nextBtn.addEventListener('click', playNextTrack);
            prevBtn.addEventListener('click', playPrevTrack);
            backBtn.addEventListener('click', returnToSelection);
        };
    </script>
</body>
</html>
